{%extends "admin/base.html" %}

{%block title %}评价管理{%endblock %}

{%block nav_comments %}active{%endblock %}

{%block breadcrumb %}
<span><i class="fas fa-star"></i> <i class="fas fa-chevron-right"></i> 评价管理</span>
{%endblock %}

{%block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin/comments.css') }}">
{% endblock %}

{% block content %}
<div class="page-container">
<div class="container">
        <!-- 页面头部 -->
        <div class="page-header">
            <div class="header-left">
                <h1><i class="fas fa-star"></i> 评价管理</h1>
                <p class="subtitle">查看和管理访客评价，分析服务质量</p>
            </div>
            <div class="header-right">
                <button class="btn-primary" onclick="window.location.href='/admin'">
                    <i class="fas fa-arrow-left"></i> 返回后台
                </button>
            </div>
        </div>

        <!-- 统计卡片 -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon" style="background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover-color) 100%);">
                    <i class="fas fa-comments"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value" id="totalComments">0</div>
                    <div class="stat-label">总评价数</div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                    <i class="fas fa-star"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value" id="avgScore">0.0</div>
                    <div class="stat-label">平均评分</div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                    <i class="fas fa-smile"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value" id="satisfaction">0%</div>
                    <div class="stat-label">满意度</div>
                </div>
            </div>

            <div class="stat-card">
                <div class="stat-icon" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                    <i class="fas fa-trophy"></i>
                </div>
                <div class="stat-content">
                    <div class="stat-value" id="fiveStarCount">0</div>
                    <div class="stat-label">五星好评</div>
                </div>
            </div>
        </div>

        <!-- 评分分布 -->
        <div class="chart-section">
            <h3><i class="fas fa-chart-bar"></i> 评分分布</h3>
            <div class="level-distribution" id="levelDistribution">
                <!-- 动态加载 -->
            </div>
        </div>

        <!-- 筛选栏 -->
        <div class="filter-bar">
            <div class="filter-group">
                <label><i class="fas fa-calendar"></i> 时间范围</label>
                <input type="date" id="startDate" class="form-control">
                <span>至</span>
                <input type="date" id="endDate" class="form-control">
            </div>

            <div class="filter-group">
                <label><i class="fas fa-user-tie"></i> 客服</label>
                <select id="serviceId" class="form-control">
                    <option value="">全部客服</option>
                    <!-- 动态加载 -->
                </select>
            </div>

            <div class="filter-group">
                <label><i class="fas fa-star"></i> 评分</label>
                <select id="level" class="form-control">
                    <option value="">全部评分</option>
                    <option value="5">⭐⭐⭐⭐⭐ (5星)</option>
                    <option value="4">⭐⭐⭐⭐ (4星)</option>
                    <option value="3">⭐⭐⭐ (3星)</option>
                    <option value="2">⭐⭐ (2星)</option>
                    <option value="1">⭐ (1星)</option>
                </select>
            </div>

            <div class="filter-actions">
                <button class="btn-primary" onclick="searchComments()">
                    <i class="fas fa-search"></i> 查询
                </button>
                <button class="btn-secondary" onclick="resetFilters()">
                    <i class="fas fa-redo"></i> 重置
                </button>
            </div>
        </div>

        <!-- 评价列表 -->
        <div class="comments-section">
            <div class="section-header">
                <h3><i class="fas fa-list"></i> 评价列表</h3>
                <button class="btn-secondary" onclick="refreshData()">
                    <i class="fas fa-sync-alt"></i> 刷新
                </button>
            </div>

            <div class="comments-list" id="commentsList">
                <!-- 动态加载 -->
            </div>

            <!-- 分页 -->
            <div class="pagination">
                <button class="page-btn" id="prevBtn" onclick="changePage(-1)" disabled>
                    <i class="fas fa-chevron-left"></i> 上一页
                </button>
                <span class="page-info" id="pageInfo">第 1 / 1 页</span>
                <button class="page-btn" id="nextBtn" onclick="changePage(1)" disabled>
                    下一页 <i class="fas fa-chevron-right"></i>
                </button>
            </div>
        </div>

        <!-- 客服排行榜（侧边栏） -->
        <div class="ranking-sidebar">
            <h3><i class="fas fa-medal"></i> 客服排行榜</h3>
            <div id="rankingList" class="ranking-list">
                <!-- 动态加载 -->
            </div>
        </div>
    </div>

    <!-- 删除确认模态框 -->
    <div id="deleteModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3>确认删除</h3>
                <button class="modal-close" onclick="closeDeleteModal()">&times;</button>
            </div>
            <div class="modal-body">
                <p style="text-align: center; padding: 20px;">
                    <i class="fas fa-exclamation-triangle" style="color: #f59e0b; font-size: 48px;"></i>
                </p>
                <p style="text-align: center; font-size: 16px;">
                    确定要删除这条评价吗？<br>
                    此操作不可恢复！
                </p>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn-secondary" onclick="closeDeleteModal()">取消</button>
                <button type="button" class="btn-danger" onclick="confirmDelete()">确定删除</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/admin/comments.js') }}"></script>
{% endblock %}
