{%extends "admin/base.html" %}

{%block title %}шо┐ховчобчРЖ{%endblock %}

{%block nav_visitors %}active{%endblock %}

{%block breadcrumb %}
<span><i class="fas fa-users"></i> <i class="fas fa-chevron-right"></i> шо┐ховчобчРЖ</span>
{%endblock %}

{%block extra_css %}
<link rel="stylesheet" href="{{ url_for('static', filename='css/admin/visitors.css') }}">
{% endblock %}

{% block content %}
<div class="page-container">
<div class="container">
        <!-- хд┤щГи -->
        <div class="header">
            <h1><i class="fas fa-users"></i> шо┐ховчобчРЖ</h1>
            <div class="header-actions">
                <button class="btn btn-success" onclick="exportVisitors()">
                    <i class="fas fa-file-export"></i> хп╝хЗ║цХ░цНо
                </button>
                <button class="btn btn-primary" onclick="refreshData()">
                    <i class="fas fa-sync-alt"></i> хИ╖цЦ░
                </button>
            </div>
        </div>

        <!-- ч╗ЯшобхНбчЙЗ -->
        <div class="stats">
            <div class="stat-card">
                <h3>цА╗шо┐ховцХ░</h3>
                <div class="value" id="totalVisitors">0</div>
            </div>
            <div class="stat-card online">
                <h3>хЬич║┐шо┐хов</h3>
                <div class="value" id="onlineVisitors">0</div>
            </div>
            <div class="stat-card new">
                <h3>цЦ░шо┐хов</h3>
                <div class="value" id="newVisitors">0</div>
            </div>
            <div class="stat-card returning">
                <h3>хЫЮшо┐хов</h3>
                <div class="value" id="returningVisitors">0</div>
            </div>
            <div class="stat-card blacklist">
                <h3>щ╗СхРНхНХ</h3>
                <div class="value" id="blacklistCount">0</div>
            </div>
        </div>

        <!-- ш┐Зц╗дхЩи -->
        <div class="filters">
            <div class="filter-row">
                <div class="filter-group">
                    <label>цРЬч┤в</label>
                    <input type="text" id="keyword" placeholder="цРЬч┤вхзУхРНуАБчФ╡шпЭуАБIP...">
                </div>
                <div class="filter-group">
                    <label>чК╢цАБ</label>
                    <select id="state">
                        <option value="">хЕищГи</option>
                        <option value="online">хЬич║┐</option>
                        <option value="offline">чж╗ч║┐</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>хИЖч╗Д</label>
                    <select id="groupId">
                        <option value="">хЕищГихИЖч╗Д</option>
                    </select>
                </div>
                <div class="filter-group">
                    <label>щ╗СхРНхНХ</label>
                    <select id="isBlacklist">
                        <option value="">хЕищГи</option>
                        <option value="0">цнгх╕╕</option>
                        <option value="1">щ╗СхРНхНХ</option>
                    </select>
                </div>
                <div class="filter-group" style="display: flex; align-items: flex-end;">
                    <button class="btn btn-primary" onclick="searchVisitors()" style="width: 100%;">
                        <i class="fas fa-search"></i> цРЬч┤в
                    </button>
                </div>
            </div>
        </div>

        <!-- шо┐ховшбица╝ -->
        <div class="visitor-table">
            <table>
                <thead>
                    <tr>
                        <th>шо┐ховф┐бцБп</th>
                        <th>шБФч│╗цЦ╣х╝П</th>
                        <th>цЭец║Рф┐бцБп</th>
                        <th>шо╛хдЗ/ц╡ПшзИхЩи</th>
                        <th>шо┐щЧоцмбцХ░</th>
                        <th>чК╢цАБ</th>
                        <th>цаЗчн╛</th>
                        <th>цЬАхРОшо┐щЧо</th>
                        <th>цУНф╜Ь</th>
                    </tr>
                </thead>
                <tbody id="visitorList">
                    <!-- хКицАБхКаш╜╜ -->
                </tbody>
            </table>
        </div>

        <!-- хИЖщб╡ -->
        <div class="pagination">
            <button onclick="changePage(-1)" id="prevBtn">
                <i class="fas fa-chevron-left"></i> ф╕Кф╕Ащб╡
            </button>
            <span id="pageInfo">чмм 1 щб╡</span>
            <button onclick="changePage(1)" id="nextBtn">
                ф╕Лф╕Ащб╡ <i class="fas fa-chevron-right"></i>
            </button>
        </div>
    </div>

    <!-- ч╝Цш╛Сшо┐ховцибцАБцбЖ -->
    <div id="editModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3><i class="fas fa-user-edit"></i> ч╝Цш╛Сшо┐ховф┐бцБп</h3>
                <button class="modal-close" onclick="closeEditModal()">&times;</button>
            </div>
            <form id="editForm" onsubmit="saveVisitor(event)">
                <div class="modal-body">
                    <input type="hidden" id="editVisitorId">
                    
                    <!-- шо┐ховф┐бцБпхНбчЙЗ -->
                    <div class="visitor-info-card">
                        <div id="editVisitorAvatar" class="edit-visitor-avatar">
                            <span class="avatar-placeholder">?</span>
                        </div>
                        <div class="visitor-info-text">
                            <h4 id="editVisitorDisplayName">шо┐ховхРНчз░</h4>
                            <p id="editVisitorStatus" class="visitor-status">
                                <span class="status-dot"></span>
                                <span class="status-text">чж╗ч║┐</span>
                            </p>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label><i class="fas fa-user"></i> шо┐ховхРНчз░</label>
                            <input type="text" id="editVisitorName" readonly>
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-id-card"></i> чЬЯхоЮхзУхРН</label>
                            <input type="text" id="editRealName" placeholder="шп╖ш╛УхЕечЬЯхоЮхзУхРН">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label><i class="fas fa-phone"></i> шБФч│╗чФ╡шпЭ</label>
                            <input type="text" id="editTel" placeholder="шп╖ш╛УхЕешБФч│╗чФ╡шпЭ">
                        </div>
                        <div class="form-group">
                            <label><i class="fas fa-address-book"></i> хЕ╢ф╗ЦшБФч│╗цЦ╣х╝П</label>
                            <input type="text" id="editConnect" placeholder="QQуАБх╛оф┐бчнЙ">
                        </div>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-tags"></i> цаЗчн╛</label>
                        <input type="text" id="editTags" placeholder="ф╛ЛхжВя╝ЪVIP,щЗНшжБховцИ╖,ц╜ЬхЬиховцИ╖">
                        <small>ЁЯТб хдЪф╕кцаЗчн╛шп╖чФищАЧхП╖хИЖщЪФ</small>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-layer-group"></i> хИЖч╗Д</label>
                        <select id="editGroupId">
                            <option value="">цЧахИЖч╗Д</option>
                            <!-- хКицАБхКаш╜╜ -->
                        </select>
                    </div>

                    <div class="form-group">
                        <label><i class="fas fa-comment-dots"></i> хдЗц│и</label>
                        <textarea id="editComment" rows="3" placeholder="шп╖ш╛УхЕехдЗц│иф┐бцБп"></textarea>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" onclick="closeEditModal()">
                        <i class="fas fa-times"></i> хПЦц╢И
                    </button>
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> ф┐ЭхнШ
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- цаЗчн╛чобчРЖцибцАБцбЖ -->
    <div id="tagModal" class="modal">
        <div class="modal-content modal-small">
            <div class="modal-header">
                <h3><i class="fas fa-tags"></i> чобчРЖцаЗчн╛</h3>
                <button class="modal-close" onclick="closeTagModal()">&times;</button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="tagVisitorId">
                
                <div class="form-group">
                    <label><i class="fas fa-plus-circle"></i> ц╖╗хКацЦ░цаЗчн╛</label>
                    <div class="tag-input-group">
                        <input type="text" id="newTag" placeholder="ш╛УхЕецаЗчн╛хРНчз░" style="flex: 1;">
                        <button type="button" class="btn btn-primary" onclick="addTag()">
                            <i class="fas fa-plus"></i> ц╖╗хКа
                        </button>
                    </div>
                </div>

                <div class="form-group">
                    <label><i class="fas fa-list"></i> х╜УхЙНцаЗчн╛</label>
                    <div id="currentTags" class="tags-container">
                        <!-- хКицАБхКаш╜╜ -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" onclick="closeTagModal()">
                    <i class="fas fa-check"></i> хоМцИР
                </button>
            </div>
        </div>
    </div>

</div>
{% endblock %}

{% block extra_js %}
<script src="{{ url_for('static', filename='js/admin/visitors.js') }}"></script>
{% endblock %}
