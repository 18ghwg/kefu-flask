<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>{% block title %}å®¢æœå·¥ä½œå°{% endblock %} - å®¢æœç³»ç»Ÿ</title>
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='favicon.svg') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/vendor/font-awesome/all.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/admin/base.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/theme-switcher.css') }}">
    <link href="{{ url_for('static', filename='css/vendor/fonts/inter.css') }}" rel="stylesheet">
    <style>
        /* å®¢æœå·¥ä½œå°ç‰¹æ®Šå¸ƒå±€ */
        .main-content {
            padding: 0 !important;
            height: calc(100vh - 60px - 40px) !important; /* å‡å»å¯¼èˆªæ 60pxå’Œåº•éƒ¨æ 40px */
            overflow: hidden !important;
            display: flex !important;
            flex-direction: column !important;
        }

        /* å“åº”å¼ï¼šå°å±å¹•è°ƒæ•´ä¸»å†…å®¹é«˜åº¦ */
        @media (max-width: 768px) {
            .main-content {
                height: calc(100vh - 60px - 35px) !important;
            }
        }

        .page-header {
            display: none; /* éšè—é¡µé¢æ ‡é¢˜ */
        }

        .breadcrumb {
            display: none; /* éšè—é¢åŒ…å±‘ */
        }

        /* Badgeæ ·å¼ */
        .badge {
            display: inline-block;
            padding: 2px 6px;
            font-size: 11px;
            font-weight: 600;
            border-radius: 10px;
            margin-left: 8px;
        }

        .badge-primary {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-hover-color) 100%);
            color: white;
        }

        .badge-success {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            color: white;
        }

        .badge-warning {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            color: white;
        }

        .badge-danger {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            color: white;
        }
    </style>
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- é¡¶éƒ¨å¯¼èˆªæ  -->
    {% include 'includes/navbar.html' %}

    <!-- å·¦ä¾§å¯¼èˆªæ  -->
    {% include 'includes/sidebar.html' %}

    <!-- é®ç½©å±‚ï¼ˆç§»åŠ¨ç«¯ï¼‰ -->
    <div class="sidebar-overlay" id="sidebarOverlay"></div>

    <!-- ä¸»å†…å®¹åŒºåŸŸ -->
    <main class="main-content" id="mainContent">
        <!-- é¡µé¢å†…å®¹ -->
        {% block content %}{% endblock %}
    </main>

    <!-- å…¨å±€åº•éƒ¨æ  -->
    {% include 'includes/footer.html' %}

    <!-- åŸºç¡€è„šæœ¬ -->
    <script>
        // åˆ‡æ¢ä¾§è¾¹æ 
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('expanded');
        }

        // åˆ‡æ¢ç”¨æˆ·èœå•
        function toggleUserMenu() {
            const menu = document.getElementById('userMenu');
            menu.classList.toggle('show');
        }

        // ç‚¹å‡»å¤–éƒ¨å…³é—­ç”¨æˆ·èœå•
        window.addEventListener('click', function(e) {
            if (!e.target.matches('.nav-link') && !e.target.closest('.dropdown')) {
                const menu = document.getElementById('userMenu');
                if (menu && menu.classList.contains('show')) {
                    menu.classList.remove('show');
                }
            }
        });

        // åˆ‡æ¢å­èœå•
        function toggleSubmenu(element) {
            const menuItem = element.parentElement;
            const submenu = menuItem.querySelector('.submenu');
            const arrow = element.querySelector('.submenu-arrow');
            
            // å…³é—­å…¶ä»–å­èœå•
            document.querySelectorAll('.menu-item.has-submenu').forEach(item => {
                if (item !== menuItem) {
                    item.classList.remove('open');
                }
            });
            
            // åˆ‡æ¢å½“å‰å­èœå•
            menuItem.classList.toggle('open');
        }

        // å“åº”å¼ä¾§è¾¹æ  - å®¢æœå·¥ä½œå°é»˜è®¤æ”¶èµ·
        let userToggledSidebar = false; // æ ‡è®°ç”¨æˆ·æ˜¯å¦æ‰‹åŠ¨åˆ‡æ¢è¿‡
        
        // é‡æ–°å®šä¹‰ toggleSidebar
        toggleSidebar = function() {
            userToggledSidebar = true; // æ ‡è®°ä¸ºç”¨æˆ·æ‰‹åŠ¨æ“ä½œ
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const overlay = document.getElementById('sidebarOverlay');
            
            // åˆ‡æ¢çŠ¶æ€
            sidebar.classList.toggle('collapsed');
            mainContent.classList.toggle('expanded');
            
            // ç§»åŠ¨ç«¯æ§åˆ¶é®ç½©å±‚
            if (window.innerWidth <= 768 && overlay) {
                overlay.classList.toggle('show');
            }
            
            console.log('ğŸ“± ä¾§è¾¹æ åˆ‡æ¢:', sidebar.classList.contains('collapsed') ? 'æ”¶èµ·' : 'å±•å¼€');
        };
        
        // ç‚¹å‡»é®ç½©å±‚å…³é—­ä¾§è¾¹æ 
        document.addEventListener('DOMContentLoaded', function() {
            const overlay = document.getElementById('sidebarOverlay');
            if (overlay) {
                overlay.addEventListener('click', function() {
                    if (window.innerWidth <= 768) {
                        toggleSidebar();
                    }
                });
            }
        });
        
        function checkScreenSize() {
            const sidebar = document.getElementById('sidebar');
            const mainContent = document.getElementById('mainContent');
            const overlay = document.getElementById('sidebarOverlay');
            
            // å¦‚æœç”¨æˆ·æ‰‹åŠ¨åˆ‡æ¢è¿‡ï¼Œå°±ä¸å†è‡ªåŠ¨è°ƒæ•´
            if (userToggledSidebar) {
                console.log('â¸ï¸ ç”¨æˆ·å·²æ‰‹åŠ¨æ“ä½œï¼Œè·³è¿‡è‡ªåŠ¨è°ƒæ•´');
                return;
            }
            
            // å®¢æœå·¥ä½œå°é»˜è®¤æ”¶èµ·ä¾§è¾¹æ ä»¥è·å¾—æ›´å¤šèŠå¤©ç©ºé—´
            sidebar.classList.add('collapsed');
            mainContent.classList.add('expanded');
            if (overlay) overlay.classList.remove('show');
            console.log('ğŸ’¬ å®¢æœå·¥ä½œå°ï¼šä¾§è¾¹æ è‡ªåŠ¨æ”¶èµ·');
        }

        window.addEventListener('resize', checkScreenSize);
        checkScreenSize();
    </script>
    
    <!-- ä¸»é¢˜ç®¡ç†å™¨ -->
    <script src="{{ url_for('static', filename='js/theme-manager.js') }}"></script>
    <script src="{{ url_for('static', filename='js/csrf_handler.js') }}"></script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>

